{% extends  'app/base.html' %}
{% load bootstrap3 %}
{% load static %}

{% block css %}
    <title>Normalizar {{documento}}</title>
    <link  rel="stylesheet" href="{% static 'normalizar.css' %}">
{% endblock css %}

{% block header %}
    <h3 style="display: inline;">Documento {{documento}}</h3>

    <img src="{% static 'imagens/gold_key.png' %}" alt="Chave Primária" title="Chave Primária" draggable="true" ondragstart="drag(event)" />

    <h3 style="display: inline;">
        <small>
            <!--<span data-toggle="modal" data-target="#dica_fn" class="glyphicon glyphicon-question-sign"></span>-->
        </small>
    </h3>

    <div class="aviso">
        <span class="titulo">1ª Forma Normal</span>
        <span id="texto-dica"></span>
    </div>
    <!--<img src="{% static 'imagens/green_key.png' %}" alt="Chave Estrangeira" title="Chave Estrangeira" />-->
{% endblock header %}

{% block content %}
    <form action="{% url 'app:normalizar' documento.id %}" method="POST">

        <div class="col-md-12">
            <h4>{{documento}}</h4>
            <input type="hidden" name="tabela_uni" value="{{documento}}"/>

            {% for campo in documento.uni %}
                <div class="campo col-md-1" id="{{campo}}_campo" ondragover="allowDrop(event)" ondrop="drop(event)" alt="{{campo}}" title="{{campo}}">
                    {{campo}}

                    <input type="hidden" id="{{campo}}_primaria" name="primaria[{{campo.id}}]" value="0" />
                    <input type="hidden" name="uni[{{campo.id}}]" value="{{campo.id}}"/>
                </div>
            {% endfor %}
        </div>

        <div class="col-md-12" style="margin-top:20px">
            <h4 contenteditable="true" id="tabela_multi_h4">{{hashe}}</h4>
            <input type="hidden" id="tabela_multi" name="tabela_multi" value="{{hashe}}" />

            {% for campo in documento.multi %}
                <div class="campo col-md-1" id="{{campo}}_campo" ondragover="allowDrop(event)" ondrop="drop(event)" alt="{{campo}}" title="{{campo}}">
                    {{campo}}

                    <input type="hidden" id="{{campo}}_primaria" name="primaria[{{campo.id}}]" value="0" />
                    <input type="hidden" name="multi[{{campo.id}}]" value="{{campo.id}}"/>
                </div>
            {% endfor %}
        </div>


        <input type="hidden" name="hashe" value="{{hashe}}"/>
        <input type="hidden" name="forma_normal" value="1" />
        {% csrf_token %}


        {% buttons %}
            <button class="btn btn-enviar" style="margin-top:30px" id="enviar">SALVAR</button>
        {% endbuttons %}
    </form>
{% endblock content %}

{% block script %}
    <script src="{% static 'scripts/normalizar.js' %}"></script>
    <script>

        $("#tabela_multi_h4").keyup(function(){
            let nome = $(this).text();
            $("#tabela_multi").val(nome);
        });




        function drag(ev){
        }

        function drop(ev){
            var aux = $(ev.target).attr("id").split("_");

            var temp = '';
            for(var i=0; i<aux.length-1; i++)
                temp += aux[i]+'_';
            temp = temp.substring(0,temp.length-1);
            if(temp == "")
                temp = aux[0];

            var id = "#"+temp+"_primaria";
            $(ev.target).css({
                "background-color": "rgb(119, 138, 102)",
                "border": "1px solid rgb(218, 213, 94)",
                "background": "rgb(255, 250, 144)"
            });
            $(id).val(1);
        }
        function allowDrop(ev){
            ev.preventDefault();
        }
    </script>
{% endblock script %}