{% extends  'app/base.html' %}
{% load bootstrap3 %}
{% load static %}

{% block css %}
    <title>Documento - {{documento}}</title>
{% endblock css %}

{% block header %}
    <h3>{{documento}}
        <!--<button type="button" id="add_tabela" class="btn btn-default btn-lg" data-toggle="modal" data-target="#addTabela">
          <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
        </button>-->
        <small>
            {% if fn < 3 %}
                <a href="{% url 'app:normalizar' documento.id %}">normalizar</a>
            {% endif %}
        </small>
    </h3>

    {% if fn < 3 %}
        Forma Normal atual: {{fn}}
    {% elif fn == 3 %}
        Documento Normalizado<br>
        <a href="{% url 'app:script_documento' documento.id %}">gerar script</a><br>
        <a href="{% url 'app:diagrama_documento' documento.id %}">gerar diagrama</a>
    {% endif %}
{% endblock header %}

{% block content %}
    {% if fn < 3 %}
        <ul class="lista-tabelas">
            {% if sem_tabela %}<h4>Campos sem tabela</h4>{% endif %}
            <ul>
                {% for campo in sem_tabela %}
                    <li>
                        {{campo}}
                    </li>
                {% empty %}
                    <h4>Não há campos sem tabelas</h4>
                {% endfor %}
            </ul>
        </ul>
    {% endif %}

    <div class="espacamento"></div>

    {% if tabelas %}<h4>Tabelas do documento {{documento}}</h4>{% else %}<h4>Não há tabelas registradas para o documento {{documento}}</h4>{% endif %}

    <div class="lista">
        {% for tabela in tabelas %}
            <div class="header" onclick="mostrar_campos({{tabela.id}});">
                {{tabela}}
            </div>

            <div style="display:none" id="campos_{{tabela.id}}">
                {% for chave in tabela.chaves %}
                    <div class="item-tabela">
                        {{chave}}
                        <img src="{% static 'imagens/gold_key.png' %}" width="17"/>
                    </div>
                {% endfor %}
                {% for chave in tabela.estrangeiras %}
                    <div class="item-tabela">
                        {{chave}}
                        <img src="{% static 'imagens/green_key.png' %}" width="17"/>
                    </div>
                {% endfor %}
                {% for campo in tabela.campos %}
                    <div class="item-tabela">{{campo}}</div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
{% endblock content %}


{% block script %}
    <script>
        /*
        $("span").click(function(){
            var id = "campos_"+$(this).attr("id");

            if($("#"+id).css("display")=="none"){
                //$("#"+id).css("display", "block");
                $("#"+id).show();
                $(this).attr("class", "glyphicon glyphicon-chevron-up");
            }
            else{
                //$("#"+id).css("display", "none");
                $("#"+id).hide();
                $(this).attr("class", "glyphicon glyphicon-chevron-down");
            }
        });*/

        function mostrar_campos(tabela_id){
            if($("#campos_"+tabela_id).css("display") == "none")
                $("#campos_"+tabela_id).show();
            else
                $("#campos_"+tabela_id).hide();
        }
    </script>
{% endblock script %}